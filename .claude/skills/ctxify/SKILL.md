---
name: ctxify
description: Use when working in a multi-repo workspace to get cross-repo context. Scaffolds context shards with ctxify init, then guides semantic analysis of repos, endpoints, types, env vars, relationships, and schemas.
---

# ctxify — Agent Playbook

## 1. Detection — Am I in a ctxify workspace?

Check the workspace root for `.ctxify/index.md`.

- **Found** → Read it. You have context. Go to **section 3**.
- **Not found** → Check for `ctx.yaml`.
  - `ctx.yaml` exists → run `ctxify init`. Then follow `.ctxify/_analysis.md`.
  - Neither exists → go to **section 2**.

## 2. First-time Setup

All repos must be subdirectories of the workspace root. Run ctxify from that root.

Inspect immediate subdirectories for manifest files (`package.json`, `go.mod`, `pyproject.toml`, `Cargo.toml`, etc.) to determine layout:

| Layout | Command |
|--------|---------|
| Single manifest at root only | `ctxify init` |
| Root manifest with `workspaces` field | `ctxify init --mono` |
| Multiple subdirs with manifests | `ctxify init --repos ./a ./b ./c` |

After init: open `.ctxify/_analysis.md` and follow the checklist to fill each shard.

## 3. Reading Context — Progressive Disclosure

Start narrow. Only read what your current task requires.

1. `.ctxify/index.md` — workspace overview, repo list, frontmatter totals
2. `.ctxify/repos/{name}.md` — single-repo detail
3. Drill into specific shard directories as needed

| Need | File |
|------|------|
| Workspace overview | `.ctxify/index.md` |
| Repo details | `.ctxify/repos/{name}.md` |
| API endpoints | `.ctxify/endpoints/{name}.md` |
| Shared types | `.ctxify/types/shared.md` |
| Env variables | `.ctxify/env/all.md` |
| Relationships | `.ctxify/topology/graph.md` |
| DB schemas | `.ctxify/schemas/{name}.md` |
| Unresolved questions | `.ctxify/questions/pending.md` |
| Analysis checklist | `.ctxify/_analysis.md` |

Shards use segment markers for targeted reads:
`<!-- endpoint:GET:/users -->`, `<!-- type:UserProfile:interface -->`, `<!-- env:DATABASE_URL -->`, etc.

## 4. Filling Shards — Semantic Analysis Guide

For each shard type, read the relevant source files, then write structured markdown inside the markers generated by init.

### Repo narrative (`repos/{name}.md`)

Write a paragraph: what the repo does, how it relates to others, what it is the source of truth for. Note the tech stack and entry point.

### Endpoints (`endpoints/{name}.md`)

Read route/controller files. Use this format per endpoint:

```
<!-- endpoint:METHOD:/path -->
**METHOD /path** — `file:line` (handlerName)
Brief description.
<!-- /endpoint -->
```

### Shared types (`types/shared.md`)

Find types exported from one repo and imported by another. Format:

```
<!-- type:Name:kind -->
**Name** — `source/file.ts:line`
Brief description of what this type represents and where it's used.
<!-- /type -->
```

### Env variables (`env/all.md`)

Check `.env`, `.env.example`, and source code references. Format:

```
<!-- env:NAME -->
**NAME** — required/optional
Used by: `repo/file.ts:line`
Description of what this variable controls.
<!-- /env -->
```

### Relationships (`topology/graph.md`)

Document how repos connect: API consumer, shared types, shared DB, event bus, etc. Include confidence (high/medium/low).

```
repo-a -> repo-b : REST API consumer (high)
repo-a -> repo-c : shared types (medium)
```

### DB schemas (`schemas/{name}.md`)

Find ORM/migration schema files. Format:

```
<!-- model:User -->
| Field | Type | Constraints |
|-------|------|-------------|
| id | uuid | PK |
| email | string | unique, not null |
<!-- /model -->
```

### Conventions (`repos/{name}.md`)

Append to the repo shard: testing framework, linter config, naming patterns, directory conventions.

### Questions (`questions/pending.md`)

Record anything uncertain as you analyze the codebase — architecture decisions, missing docs, unclear ownership, etc. Remove questions as they get answered. Use this format:

```
<!-- question:id -->
**Q:** Does repo-b call repo-a directly or via the gateway?
**Context:** Found imports in both directions.
<!-- /question -->
```

### After filling

1. Update the `totals` fields in `index.md` frontmatter (endpoints, shared_types, env_vars counts).
2. Run `ctxify validate` to check structural integrity.

## 5. Updating — Incremental Maintenance

When code changes, update only the affected shards. Do not regenerate everything.

- Edit the specific shard file and segment marker that changed.
- Run `ctxify validate` after updates.
- Run `ctxify status` to check remaining TODO count.
